name: Build Camera Wrapper (Step 1–3)

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # STEP 0 — Checkout
      - name: Checkout repo
        uses: actions/checkout@v4

      # STEP 1 — Setup Java
      - name: Setup Java
        uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: 17

      # STEP 2 — Install apktool (dependency minimal)
      - name: Install apktool
        run: |
          sudo apt update
          sudo apt install -y apktool

      # STEP 3 — Download GCam Go (langsung dari Celso)
      - name: Download GCam Go APK
        run: |
          mkdir -p base
          curl -L \
            "https://1-dontsharethislink.celsoazevedo.com/file/filesc/MGCLite_3.8.476835377_V7_ENG.apk" \
            -o base/GCamGo.apk
          ls -lh base/GCamGo.apk

      # STEP 4 — Decode APK
      - name: Decode GCam Go
        run: |
          apktool d base/GCamGo.apk -o work

      # STEP 5 — Info (debug ringan)
      - name: Check decoded structure
        run: |
          echo "==== work folder ===="
          ls work
          echo "==== work/smali ===="
          ls work/smali | head -n 5

      # STEP 6 — Build unsigned APK
      - name: Build unsigned APK
        run: |
           export JAVA_OPTS="-Xmx6g -Xms1g"
           apktool b work -o Camera-unsigned.apk
    
      # STEP 7 — Upload unsigned APK
      - name: Upload unsigned APK
        uses: actions/upload-artifact@v4
        with:
          name: camera-unsigned
          path: Camera-unsigned.apk
