name: Build Camera Wrapper (Step 1–3)

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # STEP 0 — Checkout
      - name: Checkout repo
        uses: actions/checkout@v4

      # STEP 1 — Setup Java
      - name: Setup Java
        uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: 17

      # STEP 2 — Install apktool (minimal dependency)
      - name: Install apktool
        run: |
          sudo apt update
          sudo apt install -y apktool

      # STEP 3 — Download GCam Go (TIDAK disimpan ke repo)
      - name: Download GCam Go APK
        run: |
          mkdir -p base
          curl -L -o base/GCamGo.apk https://github.com/dziie-id/Camera/releases/download/base/GCamGo.apk

      # STEP 4 — Decode APK
      - name: Decode GCam Go
        run: |
          apktool d base/GCamGo.apk -o work

      # STEP 5 — (OPSIONAL) Tempat mod / wrapper
      - name: Info decoded content
        run: |
          echo "Decoded folders:"
          ls work

      # STEP 6 — Build unsigned APK
      - name: Build unsigned APK
        run: |
          apktool b work -o Camera-unsigned.apk

      # STEP 7 — Upload hasil build
      - name: Upload unsigned APK
        uses: actions/upload-artifact@v4
        with:
          name: camera-unsigned
          path: Camera-unsigned.apk
