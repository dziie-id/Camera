name: Build & Sign GCam Go (MGCLite base)

on:
  workflow_dispatch:   # MANUAL ONLY

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install tools
        run: |
          sudo apt update
          sudo apt install -y apktool zipalign apksigner openjdk-17-jdk wget

      - name: Download base APK (MGCLite)
        run: |
          wget -O GCamGo.apk \
          https://1-dontsharethislink.celsoazevedo.com/file/filesc/MGCLite_3.8.476835377_V7_ENG.apk

      - name: Verify download
        run: |
          ls -lah GCamGo.apk

      - name: Decompile APK
        run: |
          apktool d GCamGo.apk -o gcamgo_mod

      # ðŸ”§ PATCH STEP (NANTI KITA ISI)
      - name: Patch placeholder
        run: |
          echo "Patch step skipped (to be implemented)"

      - name: Rebuild APK
        run: |
          apktool b gcamgo_mod -o gcamgo_unsigned.apk

      - name: Zipalign APK
        run: |
          zipalign -p 4 gcamgo_unsigned.apk gcamgo_aligned.apk

      - name: Sign APK with custom pk8/x509
        run: |
          apksigner sign \
            --key key/Key_20260125_203517.pk8 \
            --cert key/Key_20260125_203517.x509.pem \
            --out GCamGo_signed.apk \
            gcamgo_aligned.apk

      - name: Verify signature
        run: |
          apksigner verify --verbose GCamGo_signed.apk

      - name: Upload APK artifact
        uses: actions/upload-artifact@v4
        with:
          name: GCamGo-MGCLite-Signed
          path: GCamGo_signed.apk
          
