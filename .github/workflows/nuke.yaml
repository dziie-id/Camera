name: Nuke Repository (Keep Workflows Only)

on:
  workflow_dispatch:   # MANUAL ONLY

jobs:
  nuke:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - name: Show files before nuke
        run: |
          echo "=== BEFORE ==="
          find . -maxdepth 3 -type f | sort

      - name: Delete everything except .github/workflows
        run: |
          echo "Nuking repository contents..."

          shopt -s extglob

          # hapus semua di root KECUALI .github
          rm -rf !(.github)

          # hapus semua isi .github KECUALI workflows
          cd .github
          rm -rf !("workflows")

          echo "Nuke complete."

      - name: Show files after nuke
        run: |
          echo "=== AFTER ==="
          find . -maxdepth 3 -type f | sort

      - name: Commit changes
        run: |
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"

          git add -A
          git commit -m "chore: nuke repo, keep workflows only" || echo "Nothing to commit"
          git push
          
