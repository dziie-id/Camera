name: Manual Clear Actions History

on:
  workflow_dispatch:

permissions:
  actions: write
  contents: read

jobs:
  clear:
    runs-on: ubuntu-latest

    steps:
      - name: Delete ALL Actions runs shown in Actions tab
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          OWNER: ${{ github.repository_owner }}
          REPO: ${{ github.event.repository.name }}
        run: |
          set -e

          PAGE=1
          PER_PAGE=100

          echo "Starting manual deletion of Actions history..."

          while true; do
            RESPONSE=$(curl -s \
              -H "Authorization: Bearer $GH_TOKEN" \
              -H "Accept: application/vnd.github+json" \
              "https://api.github.com/repos/$OWNER/$REPO/actions/runs?per_page=$PER_PAGE&page=$PAGE")

            RUN_IDS=$(echo "$RESPONSE" | jq -r '.workflow_runs[].id')

            if [ -z "$RUN_IDS" ]; then
              echo "No more runs found. Finished."
              break
            fi

            for RUN_ID in $RUN_IDS; do
              echo "Deleting run ID: $RUN_ID"
              curl -s -X DELETE \
                -H "Authorization: Bearer $GH_TOKEN" \
                -H "Accept: application/vnd.github+json" \
                "https://api.github.com/repos/
                
